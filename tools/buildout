#!/bin/sh

PPM=1
RAW=1
PCM=1

FRAMESTEP=2
SAMPLES=735
PCMFACTOR=1

#MAXSCORE=3712
MAXSCORE=2560

MOV2PPM=~/git/cocovid/tools/mov2ppm
PPM2RAW=~/git/cocovid/tools/ppm2raw
RAW2RLE=~/git/cocovid/tools/raw2rle
RAW2DRW=~/git/cocovid/tools/raw2drw
DRW2DRL=~/git/cocovid/tools/drw2drl
DRL2RAW=~/git/cocovid/tools/drl2raw
WAV2PCM=~/git/cocovid/tools/wav2pcm
SPLITPCM=~/git/cocovid/tools/splitpcm
DRLPRUNE=~/git/cocovid/tools/drlprune

RAWBASE=../raw/"$1"
DRWBASE=../drw/"$1"
DRLBASE=../drl/"$1"
PCMBASE=../pcm/"$1"

mkdir -p $RAWBASE
mkdir -p $DRWBASE
mkdir -p $DRLBASE
mkdir -p $PCMBASE

if [ $PPM -ne 0 ]
then
	echo Converting .mov file to a sequence of .ppm files...
	mkdir -p ../ppm/"$1"
	cd ../ppm/"$1"
	rm -f *
	$MOV2PPM ../../mov/"$1".mov >/dev/null 2>&1
	FRAMES=$(ls | wc -l)
	cd - >/dev/null
else
	cd ../ppm/"$1"
	FRAMES=$(ls | wc -l)
	cd - >/dev/null
fi

if [ $RAW -ne 0 ]
then
	echo Converting .ppm files to .raw files...
	mkdir -p ../raw/"$1"
	cd ../raw/"$1"
	rm -f *
	for i in ../../ppm/"$1"/*
	do
	$PPM2RAW $i $(echo $(basename $i) | sed -e 's/ppm$/raw/')
	done
	cd - >/dev/null
fi

if [ $PCM -ne 0 ]
then
	echo Converting .wav file to .pcm file and split into appropriately sized chunks...
	mkdir -p ../pcm/"$1"
	cd ../pcm/"$1"
	rm -f *
	$WAV2PCM ../../mov/"$1".wav "$1".pcm $PCMFACTOR
	$SPLITPCM "$1".pcm "$1". $SAMPLES 2>/dev/null
	cd - >/dev/null
fi

CURRAW=${RAWBASE}/current.raw
TMPRAW=${RAWBASE}/tmp.raw

xxd -r >$CURRAW <<FRAMEZERO
0000000: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000010: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000020: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000040: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000050: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000060: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000070: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000080: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000090: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000100: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000120: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000130: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000140: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000150: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000160: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000170: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000180: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000190: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00001a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00001b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00001c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00001d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00001e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00001f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000200: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000210: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000220: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000230: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000240: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000250: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000260: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000270: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000280: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000290: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00002a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00002b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00002c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00002d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00002e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00002f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000300: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000310: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000320: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000330: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000340: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000350: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000360: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000370: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000380: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000390: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00003a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00003b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00003c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00003d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00003e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00003f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000400: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000410: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000420: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000430: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000440: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000450: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000460: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000470: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000480: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000490: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00004a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00004b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00004c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00004d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00004e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00004f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000500: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000510: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000520: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000530: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000540: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000550: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000560: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000570: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000580: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000590: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00005a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00005b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00005c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00005d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00005e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00005f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000600: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000610: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000620: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000630: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000640: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000650: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000660: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000670: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000680: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000690: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00006a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00006b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00006c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00006d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00006e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00006f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000700: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000710: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000720: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000730: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000740: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000750: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000760: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000770: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000780: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000790: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00007a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00007b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00007c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00007d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00007e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00007f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000800: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000810: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000820: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000830: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000840: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000850: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000860: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000870: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000880: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000890: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00008a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00008b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00008c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00008d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00008e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00008f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000900: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000910: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000920: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000930: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000940: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000950: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000960: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000970: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000980: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000990: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00009a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00009b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00009c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00009d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00009e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00009f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a00: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a10: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a20: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a30: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a40: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a50: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000a90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000aa0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ab0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ac0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ad0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ae0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000af0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b00: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b10: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b20: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b30: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b40: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b50: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000b90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ba0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000bb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000bc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000bd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000be0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000bf0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c00: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c10: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c20: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c30: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c40: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c50: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000c90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ca0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000cb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000cc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000cd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ce0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000cf0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d00: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d10: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d20: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d30: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d40: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d50: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000d90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000da0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000db0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000dc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000dd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000de0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000df0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e00: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e10: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e20: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e30: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e40: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e50: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000e90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ea0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000eb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ec0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ed0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ee0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ef0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f00: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f10: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f20: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f30: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f40: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f50: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000f90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000fa0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000fb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000fc0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000fd0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000fe0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000ff0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001000: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001010: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001020: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001030: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001040: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001050: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001060: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001070: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001080: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001090: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00010a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00010b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00010c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00010d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00010e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00010f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001100: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001110: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001120: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001130: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001140: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001150: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001160: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001170: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001180: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001190: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00011a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00011b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00011c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00011d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00011e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00011f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001200: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001210: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001220: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001230: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001240: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001250: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001260: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001270: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001280: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001290: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00012a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00012b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00012c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00012d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00012e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00012f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001300: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001310: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001320: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001330: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001340: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001350: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001360: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001370: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001380: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001390: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00013a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00013b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00013c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00013d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00013e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00013f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001400: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001410: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001420: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001430: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001440: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001450: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001460: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001470: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001480: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001490: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00014a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00014b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00014c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00014d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00014e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00014f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001500: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001510: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001520: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001530: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001540: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001550: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001560: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001570: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001580: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001590: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00015a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00015b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00015c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00015d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00015e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00015f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001600: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001610: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001620: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001630: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001640: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001650: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001660: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001670: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001680: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001690: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00016a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00016b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00016c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00016d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00016e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00016f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001700: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001710: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001720: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001730: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001740: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001750: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001760: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001770: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001780: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0001790: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00017a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00017b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00017c0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00017d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00017e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00017f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
FRAMEZERO

echo Building final output file...

$RAW2RLE $CURRAW ${RAWBASE}/first.rle
cat ${RAWBASE}/first.rle > "$2"
dd if=/dev/zero bs=$SAMPLES count=1 2>/dev/null >> "$2"

for i in $(seq 1 $FRAMESTEP $FRAMES)
do
	RAW=${RAWBASE}/$i.raw
	DRW=${DRWBASE}/${i}-cur.drw
	DRL=${DRLBASE}/${i}-cur.drl
	DRLOUT=${DRLBASE}/${i}-out.drl
	PCMFILE=${PCMBASE}/*.$((${i}/$FRAMESTEP))

	$RAW2DRW $CURRAW $RAW $DRW
	$DRW2DRL $DRW $DRL
	$DRLPRUNE $DRL $DRLOUT $MAXSCORE
	cat $DRLOUT
	$DRL2RAW $CURRAW $DRLOUT $TMPRAW
	mv $TMPRAW $CURRAW
	if [ -f $PCMFILE ]
	then
		cat $PCMFILE
		PCMSIZE=$(stat -c '%s' $PCMFILE)
		if [ $PCMSIZE -lt $SAMPLES ]
		then
			dd if=/dev/zero bs=$(($SAMPLES - $PCMSIZE)) count=1 2>/dev/null
		fi
	else
		# This actually holds DAC at lowest value...
		# ...should output 0x88 ("CoCo Law" virtual zero) instead?
		dd if=/dev/zero bs=$SAMPLES count=1 2>/dev/null
	fi
done >> "$2"

echo Done!
